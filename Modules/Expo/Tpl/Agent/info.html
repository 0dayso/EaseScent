<include file="Common:header" />
      <include file="Agent:header" />
        <div class="z_aWrap clear">
            <include file="Common:godos_leftSide" />
            <div class="z_aWrap_r">
                <form action="{:U('Agent/info')}" method="post" id="myform">
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td align="right" class="td1" width="20%">
                        	{$Think.lang.company_name}：
                                </td>
                                <td>
                                    <input class="w470" type="text" value="{$qy_list['qy_name']}" name="qy_name" id="qy_name" onblur="check_qy(this)">
                                    <span class="table_tip" style="display:none;top:0px" id="qy_ts" >企业名称字数在3-20之间</span>
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1" width="20%">
                        	{$Think.lang.registered_address}：
                                </td>
                                <td>
                                    <select id="reg_province" onchange="TwoSelectInit(area_reg,this.value)">
                                    </select>
                                    <select id="reg_city" >
                                    </select>
                                    <input  type="hidden" name="qy_reg_province" id="qy_reg_province" value="{$qy_list['qy_reg_province']}"/>
                                    <input  type="hidden" name="qy_reg_city" id="qy_reg_city" value="{$qy_list['qy_reg_city']}"/>
                                    <input class="w240" type="text" name="qy_reg_address" value="{$qy_list['qy_reg_address']}"/>
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1" width="20%">
                        	{$Think.lang.company_address}：
                                </td>
                                <td>
                                    <select id="province" onchange="TwoSelectInit(area,this.value)">
                                    </select>
                                    <select id="city">
                                    </select>
                                    <input  type="hidden" name="qy_province" id="qy_province" value="{$qy_list['qy_province']}"/>
                                    <input  type="hidden" name="qy_city" id="qy_city" value="{$qy_list['qy_city']}"/>
                                    <input class="w240" type="text" name="qy_address" value="{$qy_list['qy_address']}"/>
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1" width="20%">
                        	{$Think.lang.email}：
                                </td>
                                <td>
                                    <input class="w290" type="text" name="agent_email" value="{$agent['email']}"/>
                                </td>
                            </tr>



                    <tr>
                        <td align="right" class="td1">
                           {$Think.lang.enterprise_image}：
                        </td>
                        <td>
                            <div id="rm_img" >
                                <volist name="img_list" id="img">
                                    <if condition="isset($img_list[0])">
                                        <input type="hidden" value="{$img_list[0]['path']}" name="img_file[]">
                                        <input type="hidden" value="1" name="img_queue[]">
                                        <img width="575px"  src="{$img_list[0]['url']}"><br/><br/>
                                    </if>
                                </volist>
                            </div>

                            <div class="z_upPicBox">
                                <p>企业形象照片，用于企业首页的导航下展示。<br>请上传宽度为980px图片</p>
                                <a href="javascript:;"  id="file_uploadify"><img src="__PUBLIC__/Expo/img/upPicBtn.gif"></a>

                            </div>
                        </td>
                    </tr>





                       <!--原始版本 imglist 请勿删除 <tr>
                            <td align="right" class="td1">
                    	{$Think.lang.enterprise_image}：
                            </td>
                            <td>
                                <ul class="upLoadPicUl clear" >
                                    <if condition="$img_list neq ''">
                                        <volist name="img_list" id="img">
                                            <li>
                                                <input type="hidden" value="{$img['path']}" name="img_file[]">
                                                <input type="hidden" value="1" name="img_queue[]">
												<img width="100%" height="100%" src="{$img['url']}">
                                                <p class="pic_closeBtn">
													<img src="__PUBLIC__/Expo/img/pic_closeBtn.gif" onclick="delImg({$img['id']},this);">
												</p>
												<if condition="$img['queue'] neq '1'">
													<p class="txt"><a href="#" onclick="first(this)"></a></p>
												</if>
                                            </li>
                                        </volist>

                                    </if>
                                    <if condition="$img_count neq '4'">
                                       <li> <a href="javascript:;" id="file_uploadify"></a></li>
                                    </if>
                                </ul>
                                <input type="hidden" name="allImg" id="allImg">
                            </td>
                        </tr>-->



                            <tr>
                                <td align="right" class="td1" width="20%">
                        	skype：
                                </td>
                                <td style="border-top:1px dotted #ccc;">
                                    <input class="w290" type="text" value="{$qy_list['qy_skype']}" name="qy_skype"/>
                                    <span class="table_tip">填写Skype、QQ并保持在线，能获得更多的产品资讯和交易。</span>
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1" width="20%">
                        	QQ：
                                </td>
                                <td>
                                    <input class="w290" type="text" value="{$qy_list['qy_qq']}" name="qy_qq" id="qy_qq" onblur="check_qq(this)"/>
                                    <span class="table_tip" style="display:none;top:0px" id="qq_ts" >输入格式错误，请输入qq数字号码</span>
                                </td>
                            </tr>
                            <tr>
                                <td>

                                </td>
                                <td style="border-top:1px dotted #ccc;">

                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1" width="20%">
                           {$Think.lang.telephone}：
                                </td>
                                <td>
                                    <input class="w290" type="text" value="{$qy_list['qy_moblie']}" name="qy_moblie"/>
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1" width="20%">
                        	 {$Think.lang.website}：
                                </td>
                                <td>
                                    <input class="w470" type="text" value="{$qy_list['qy_web_address']}" name="qy_web_address"/>
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1" valign="top">
                        	{$Think.lang.intro}：
                                </td>
                                <td>
                                    <textarea class="z_aWrap_txta"  name="qy_introduction" id="qy_introduction">{$qy_list['qy_introduction']}</textarea>
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td1">&nbsp;

                                </td>
                                <td>
                                    <input type="submit" name="submit_add" class="form-submit" value="提           交" style="width:500px;">
                                    <!-- <a href="javascript:void(0)" class="pinkBtn"onclick="tx()"><span>{$Think.lang.submit}</span></a> -->
                                </td>
                            </tr>
                        </tbody>
                    </table></form>
            </div>
        </div>



   <!--原始版本的 js 1.0 -->
   <script>
     var cfg = {
            province:      "{$qy_list['qy_province']}",
            city    :      "{$qy_list['qy_city']}",
            reg_province : "{$qy_list['qy_reg_province']}",
            reg_city :     "{$qy_list['qy_reg_city']}"
        };

    </script>


    <script language="javascript" src="__PUBLIC__/Expo/js/region_select.js"></script>
    <script type="text/javascript">
        function tx(){
         if(check_qy()&& check_qq()){
             javascript:document.getElementById('myform').submit();
         }

        }

        var editor;
        var cur_img_num = '<?php echo $img_count;?>';

        function first(o){
        var parent = o.parentNode.parentNode;
        parent.parentNode.insertBefore(o.parentNode.parentNode,parent.parentNode.firstChild);
        }

        function delImg(id, obj){
        cur_img_num--;
        console.log(cur_img_num);
        $(obj).parent().parent().remove();
        $(".upLoadPicUl li").each(function(k, v){
            if( $(this).find(":input[name='img_queue[]']").val() != undefined)
                $(this).find(":input[name='img_queue[]']").val(k+1);
        })
        if (cur_img_num < 100 ) {
            init_uploadify();
            $(".upLoadPicUl li").last().show();
        }
        }

        $(document).ready(function(){
            $("#reg_province").change(function(){
                var a = $('#reg_province').find('option:selected').text();
                $('#qy_reg_province').val(a);
                });
            $("#reg_city").change(function(){
                var a = $('#reg_city').find('option:selected').text();
                $('#qy_reg_city').val(a);
                });
            $("#province").change(function(){
                var a = $('#province').find('option:selected').text();
                $('#qy_province').val(a);
                });
            $("#city").change(function(){
                var a = $('#city').find('option:selected').text();
                $('#qy_city').val(a);
                });
            init_uploadify();
        });

        // 发布微博图片上传
        init_uploadify = function(){
            $(function(){
                $('#file_uploadify').uploadify({
                    'swf'             : '__PUBLIC__/Expo/uploadify/uploadify.swf',
                    'uploader'        : '__PUBLIC__/Expo/uploadify/uploadify.php?type=qy',
                    'buttonImage'     : '__PUBLIC__/Expo/img/upPicBtn.gif',
                    'height'          : 25,
                    'width'           : 80,
                    'auto'            : true,
                    'buttonCursor'    : 'hand',
                    'fileTypeDesc' : 'Image Files',
                    'fileTypeExts' : '*.gif; *.jpg; *.png',
                    'removeCompleted' : true,
                    'fileSizeLimit' : '2048KB',
                    'onUploadError'          : function (file, errorCode, errorMsg, errorString){
                    alert('The file ' + file.name + ' could not be uploaded: ' + errorString);
                    },
                    'onUploadSuccess' : function(file, data, response){
                    data = eval("("+ data +")");

                    if (data.error === 0) {
                    /**
                     * @brief  计算图片长宽比例
                     */
                        var img_width = '', img_height = '';
                        if (data.width > data.height){
                            var img_size_html = 'width="576px"';
                        } else {
                            var img_size_html = 'height="100%"';
                        }

                    if(cur_img_num < 100){
                        cur_img_num++;
                        console.log(cur_img_num);

                        var html='<li id="imglist" style="list-style:none;"><input name="img_file[]" type="hidden" value="'+data.filename+'" />'
                                +'<input name="img_queue[]" class="img_queue"type="hidden" value="'+cur_img_num+'" />'
                                +'<img src="'+data.url+'" '+img_size_html+' /> '
                                //+'<p class="pic_closeBtn"><img src="__PUBLIC__/Expo/img/pic_closeBtn.gif" onclick="delImg(-1,this)" /></p>' //要恢复 上多张图片 请开启这行
                                +'<a href="#" onclick="first(this)"></a></li>';

                        $("#rm_img").children().remove(); $("#imglist").remove(); //要恢复 上多张图片 请删除这行
                        $("#rm_img").html(html)
                        //$("#file_uploadify").parent().before(html);  //要恢复 上多张图片 请开启这行

                        if (cur_img_num === 100) {
                            $('#file_uploadify').uploadify('stop');
                            $('#file_uploadify').uploadify('destroy');
                            $(".upLoadPicUl li").last().html('<a href="javascript:;" id="file_uploadify"></a>').hide();
                        }
                    }

                    }
                    }

                });
            });
        }

    </script>
<include file="Common:footer" />
